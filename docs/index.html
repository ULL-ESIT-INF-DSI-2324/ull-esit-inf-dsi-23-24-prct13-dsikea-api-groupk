<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>doc-test</title><meta name="description" content="Documentation for doc-test"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">doc-test</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>doc-test</h2></div><div class="tsd-panel tsd-typography"><a id="md:práctica-13---dsikea-api-rest-con-nodeexpress" class="tsd-anchor"></a><h3><a href="#md:práctica-13---dsikea-api-rest-con-nodeexpress">Práctica 13 - DSIkea: API REST con Node/Express</a></h3><p><a href="https://github.com/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct13-dsikea-api-groupk/actions/workflows/node.js.yml"><img src="https://github.com/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct13-dsikea-api-groupk/actions/workflows/node.js.yml/badge.svg" alt="Tests"></a></p>
<p><a href="https://coveralls.io/github/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct13-dsikea-api-groupk?branch=main"><img src="https://coveralls.io/repos/github/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct13-dsikea-api-groupk/badge.svg?branch=main" alt="Coverage Status"></a></p>
<p><a href="https://sonarcloud.io/summary/new_code?id=ULL-ESIT-INF-DSI-2324_ull-esit-inf-dsi-23-24-prct13-dsikea-api-groupk"><img src="https://sonarcloud.io/api/project_badges/measure?project=ULL-ESIT-INF-DSI-2324_ull-esit-inf-dsi-23-24-prct13-dsikea-api-groupk&metric=alert_status" alt="Quality Gate Status"></a></p>
<a id="md:datos-identificativos---grupo-k" class="tsd-anchor"></a><h2><a href="#md:datos-identificativos---grupo-k">Datos identificativos - Grupo K</a></h2><ul>
<li>Guillermo Díaz Bricio - alu0101505688</li>
<li>Jóse Miguel Díaz González - alu0101203294</li>
<li>Diego Díaz Fernández - alu0101130026</li>
</ul>
<a id="md:objetivos" class="tsd-anchor"></a><h2><a href="#md:objetivos">Objetivos</a></h2><p>En esta práctica, la segunda grupal y última de la asignatura, se nos pide implementar un API REST usando Node/Express que lleve a cabo operaciones CRUD sobre clientes, muebles, proveedores y transacciones. También debemos hacer uso de MongoDB como sistema de base de datos y Moongose para gestionarla.</p>
<p>Para ello hemos estructurado el código en distintas carpetas que iremos comentando poco a poco. La primera que vemos va a ser la carpeta models.</p>
<a id="md:models" class="tsd-anchor"></a><h2><a href="#md:models">Models</a></h2><p>En esta carpeta se encuentran los modelos de los 4 objetos con los que tenemos que trabajar. Comentaremos el cliente, porque el resto son prácticamente iguales. Lo primero será definir una interfaz, que extiende a Document de moongose. En ella definiremos los datos de un cliente como nombre, teléfono...  </p>
<pre><code><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-3">CustomerDocumentInterface</span><span class="hl-1"> </span><span class="hl-2">extends</span><span class="hl-1"> </span><span class="hl-3">Document</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">name</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">surname</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">telephoneNumber</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">email</span><span class="hl-1">?: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">address</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">postalCode</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">city</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">gender</span><span class="hl-1">?: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">nif</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Lo siguiente será definir su schema, explicando qué debe haber en cada campo de los datos que definimos en la interfaz anterior.</p>
<pre><code><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-5">CustomerSchema</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-6">Schema</span><span class="hl-1">&lt;</span><span class="hl-3">CustomerDocumentInterface</span><span class="hl-1">&gt;({</span><br/><span class="hl-1">  </span><span class="hl-4">name:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">lowercase:</span><span class="hl-1"> </span><span class="hl-2">true</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">surname:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">lowercase:</span><span class="hl-1"> </span><span class="hl-2">true</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">telephoneNumber:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">unique:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">validate</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">// Permite diferentes formatos de número de teléfono</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-6">match</span><span class="hl-1">(</span><span class="hl-8">/</span><span class="hl-9">^</span><span class="hl-10">(</span><span class="hl-11">\+</span><span class="hl-8">34</span><span class="hl-9">|</span><span class="hl-8">0034</span><span class="hl-9">|</span><span class="hl-8">34</span><span class="hl-10">)</span><span class="hl-12">?</span><span class="hl-10">[</span><span class="hl-8"> -</span><span class="hl-10">]</span><span class="hl-12">*</span><span class="hl-10">(</span><span class="hl-8">6</span><span class="hl-9">|</span><span class="hl-8">7</span><span class="hl-10">)[</span><span class="hl-8"> -</span><span class="hl-10">]</span><span class="hl-12">*</span><span class="hl-10">([</span><span class="hl-8">0-9</span><span class="hl-10">][</span><span class="hl-8"> -</span><span class="hl-10">]</span><span class="hl-12">*</span><span class="hl-10">)</span><span class="hl-12">{8}</span><span class="hl-8">/</span><span class="hl-1">)) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-6">Error</span><span class="hl-1">(</span><span class="hl-13">&quot;Telephone number format is not valid&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">email:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">unique:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">validate</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-6">match</span><span class="hl-1">(</span><span class="hl-8">/</span><span class="hl-9">^</span><span class="hl-10">[</span><span class="hl-8">a-zA-Z0-9._%+-</span><span class="hl-10">]</span><span class="hl-12">+</span><span class="hl-8">@</span><span class="hl-10">[</span><span class="hl-8">a-zA-Z0-9.-</span><span class="hl-10">]</span><span class="hl-12">+</span><span class="hl-11">\.</span><span class="hl-10">[</span><span class="hl-8">a-zA-Z</span><span class="hl-10">]</span><span class="hl-12">{2,}</span><span class="hl-9">$</span><span class="hl-8">/</span><span class="hl-1">)) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-6">Error</span><span class="hl-1">(</span><span class="hl-13">&quot;Email format is not valid&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">lowercase:</span><span class="hl-1"> </span><span class="hl-2">true</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">address:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">lowercase:</span><span class="hl-1"> </span><span class="hl-2">true</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">postalCode:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">city:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">lowercase:</span><span class="hl-1"> </span><span class="hl-2">true</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">gender:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">validate</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> [</span><span class="hl-13">&quot;male&quot;</span><span class="hl-1">, </span><span class="hl-13">&quot;female&quot;</span><span class="hl-1">, </span><span class="hl-13">&quot;other&quot;</span><span class="hl-1">].</span><span class="hl-6">includes</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-6">toLowerCase</span><span class="hl-1">()); </span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">lowercase:</span><span class="hl-1"> </span><span class="hl-2">true</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">nif:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">unique:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">validate</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-6">match</span><span class="hl-1">(</span><span class="hl-8">/</span><span class="hl-9">^</span><span class="hl-10">[</span><span class="hl-8">0-9</span><span class="hl-10">]</span><span class="hl-12">{8}</span><span class="hl-10">[</span><span class="hl-8">a-zA-Z</span><span class="hl-10">]</span><span class="hl-8">/</span><span class="hl-1">)) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-6">Error</span><span class="hl-1">(</span><span class="hl-13">&quot;Invalid Nif&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">validator</span><span class="hl-1">.</span><span class="hl-6">isAlphanumeric</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">)) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-6">Error</span><span class="hl-1">(</span><span class="hl-13">&quot;Only Alphanumeric characters are allowed&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Por último, lo que debemos hacer es instanciar el cliente utilizando model, ayudándonos de su interfaz y schema.</p>
<pre><code><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-5">Customer</span><span class="hl-1"> = </span><span class="hl-6">model</span><span class="hl-1">&lt;</span><span class="hl-3">CustomerDocumentInterface</span><span class="hl-1">&gt;(</span><br/><span class="hl-1">  </span><span class="hl-13">&quot;Customer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">CustomerSchema</span><span class="hl-1">,</span><br/><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<p>Los otros 3 objetos que son mueble, proveedor y transacción siguen la misma estructura como ya comentamos y se han descrito en ficheros diferentes. Pasamos ahora a explicar la siguiente carpeta.</p>
<a id="md:routers" class="tsd-anchor"></a><h2><a href="#md:routers">Routers</a></h2><p>Para esta carpeta, seguiremos la idea de la carpeta anterior, explicaremos el fichero de los clientes porque los demás siguen ese esquema. Primero definiremos como se publica un cliente en la db.</p>
<pre><code><br/><span class="hl-4">CustomerRouter</span><span class="hl-1">.</span><span class="hl-6">post</span><span class="hl-1">(</span><span class="hl-13">&quot;/customers&quot;</span><span class="hl-1">, (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-5">customer</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-6">Customer</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">customer</span><br/><span class="hl-1">    .</span><span class="hl-6">save</span><span class="hl-1">()</span><br/><span class="hl-1">    .</span><span class="hl-6">then</span><span class="hl-1">((</span><span class="hl-4">customer</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-14">200</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">customer</span><span class="hl-1">);</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    .</span><span class="hl-6">catch</span><span class="hl-1">((</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-14">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Después lo que haremos será definir dos getters, uno buscándolo por su nif y el otro buscándolo por su id.</p>
<pre><code><br/><span class="hl-4">customerRouter</span><span class="hl-1">.</span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-13">&quot;/customers&quot;</span><span class="hl-1">, (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-5">nif</span><span class="hl-1"> = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nif</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">nif</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">Customer</span><span class="hl-1">.</span><span class="hl-6">find</span><span class="hl-1">({</span><span class="hl-4">nif:</span><span class="hl-1"> </span><span class="hl-4">nif</span><span class="hl-1">}).</span><span class="hl-6">then</span><span class="hl-1">((</span><span class="hl-4">customers</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">customers</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> !== </span><span class="hl-14">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-14">200</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">customers</span><span class="hl-1">);</span><br/><span class="hl-1">      } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-14">404</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-13">&quot;Customer not found&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      } </span><br/><span class="hl-1">      })</span><br/><span class="hl-1">      .</span><span class="hl-6">catch</span><span class="hl-1">((</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-14">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">  } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-14">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-13">&quot;Nif not provided&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><br/><span class="hl-4">customerRouter</span><span class="hl-1">.</span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-13">&quot;/customers/:id&quot;</span><span class="hl-1">, (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">Customer</span><span class="hl-1">.</span><span class="hl-6">findById</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">)</span><br/><span class="hl-1">    .</span><span class="hl-6">then</span><span class="hl-1">((</span><span class="hl-4">customer</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">customer</span><span class="hl-1">) </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-14">404</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-13">&quot;Customer not found&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-14">200</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">customer</span><span class="hl-1">);</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    .</span><span class="hl-6">catch</span><span class="hl-1">((</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-14">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Lo siguiente serán los patch del cliente, igual que antes, uno por su nif y el otro por su id.</p>
<pre><code><span class="hl-4">customerRouter</span><span class="hl-1">.</span><span class="hl-6">patch</span><span class="hl-1">(</span><span class="hl-13">&quot;/customers&quot;</span><span class="hl-1">, (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-5">nif</span><span class="hl-1"> = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nif</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">nif</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-5">allowedUpdates</span><span class="hl-1"> = [</span><br/><span class="hl-1">      </span><span class="hl-13">&quot;name&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-13">&quot;surname&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-13">&quot;telephoneNumber&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-13">&quot;email&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-13">&quot;address&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-13">&quot;postalCode&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-13">&quot;city&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-13">&quot;gender&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    ];</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-5">actualUpdates</span><span class="hl-1"> = </span><span class="hl-4">Object</span><span class="hl-1">.</span><span class="hl-6">keys</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-5">isValidUpdate</span><span class="hl-1"> = </span><span class="hl-4">actualUpdates</span><span class="hl-1">.</span><span class="hl-6">every</span><span class="hl-1">((</span><span class="hl-4">update</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><br/><span class="hl-1">      </span><span class="hl-4">allowedUpdates</span><span class="hl-1">.</span><span class="hl-6">includes</span><span class="hl-1">(</span><span class="hl-4">update</span><span class="hl-1">),</span><br/><span class="hl-1">    );</span><br/><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">isValidUpdate</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-14">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-13">&quot;Update not permitted&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">Customer</span><span class="hl-1">.</span><span class="hl-6">findOneAndUpdate</span><span class="hl-1">({ </span><span class="hl-4">nif:</span><span class="hl-1"> </span><span class="hl-4">nif</span><span class="hl-1"> }, </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">, {</span><br/><span class="hl-1">        </span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">      })</span><br/><span class="hl-1">        .</span><span class="hl-6">then</span><span class="hl-1">((</span><span class="hl-4">customer</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">customer</span><span class="hl-1">) </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-14">404</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-13">&quot;Customer not found&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">          </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-14">200</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">customer</span><span class="hl-1">);</span><br/><span class="hl-1">        })</span><br/><span class="hl-1">        .</span><span class="hl-6">catch</span><span class="hl-1">((</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-14">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-14">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-13">&quot;Nif not provided&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-7">/**</span><br/><span class="hl-7"> * Patch del cliente con su id</span><br/><span class="hl-7"> */</span><br/><span class="hl-4">customerRouter</span><span class="hl-1">.</span><span class="hl-6">patch</span><span class="hl-1">(</span><span class="hl-13">&quot;/customers/:id&quot;</span><span class="hl-1">, (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-5">allowedUpdates</span><span class="hl-1"> = [</span><br/><span class="hl-1">    </span><span class="hl-13">&quot;name&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-13">&quot;surname&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-13">&quot;telephoneNumber&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-13">&quot;email&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-13">&quot;address&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-13">&quot;postalCode&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-13">&quot;city&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-13">&quot;gender&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  ];</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-5">actualUpdates</span><span class="hl-1"> = </span><span class="hl-4">Object</span><span class="hl-1">.</span><span class="hl-6">keys</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-5">isValidUpdate</span><span class="hl-1"> = </span><span class="hl-4">actualUpdates</span><span class="hl-1">.</span><span class="hl-6">every</span><span class="hl-1">((</span><span class="hl-4">update</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><br/><span class="hl-1">    </span><span class="hl-4">allowedUpdates</span><span class="hl-1">.</span><span class="hl-6">includes</span><span class="hl-1">(</span><span class="hl-4">update</span><span class="hl-1">),</span><br/><span class="hl-1">  );</span><br/><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">isValidUpdate</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-14">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-13">&quot;Update not permitted&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">Customer</span><span class="hl-1">.</span><span class="hl-6">findByIdAndUpdate</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">, </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">, {</span><br/><span class="hl-1">      </span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">      .</span><span class="hl-6">then</span><span class="hl-1">((</span><span class="hl-4">customer</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">customer</span><span class="hl-1">) </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-14">404</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-13">&quot;Customer not found&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-14">200</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">customer</span><span class="hl-1">);</span><br/><span class="hl-1">      })</span><br/><span class="hl-1">      .</span><span class="hl-6">catch</span><span class="hl-1">((</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-14">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Por último definimos los métodos para borrar clientes de la db, una vez más primero con su nif y después con el id.</p>
<pre><code><span class="hl-4">customerRouter</span><span class="hl-1">.</span><span class="hl-6">delete</span><span class="hl-1">(</span><span class="hl-13">&quot;/customers&quot;</span><span class="hl-1">, (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-5">nif</span><span class="hl-1"> = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nif</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">nif</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">Customer</span><span class="hl-1">.</span><span class="hl-6">findOneAndDelete</span><span class="hl-1">({ </span><span class="hl-4">nif:</span><span class="hl-1"> </span><span class="hl-4">nif</span><span class="hl-1"> })</span><br/><span class="hl-1">      .</span><span class="hl-6">then</span><span class="hl-1">((</span><span class="hl-4">customer</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">customer</span><span class="hl-1">) </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-14">404</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-13">&quot;Customer not found&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-14">200</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">customer</span><span class="hl-1">);</span><br/><span class="hl-1">      })</span><br/><span class="hl-1">      .</span><span class="hl-6">catch</span><span class="hl-1">((</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-14">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">  } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-14">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-13">&quot;Nif not provided&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><br/><span class="hl-4">customerRouter</span><span class="hl-1">.</span><span class="hl-6">delete</span><span class="hl-1">(</span><span class="hl-13">&quot;/customers/:id&quot;</span><span class="hl-1">, (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">Customer</span><span class="hl-1">.</span><span class="hl-6">findByIdAndDelete</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">)</span><br/><span class="hl-1">    .</span><span class="hl-6">then</span><span class="hl-1">((</span><span class="hl-4">customer</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">customer</span><span class="hl-1">) </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-14">404</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-13">&quot;Customer not found&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-14">200</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">customer</span><span class="hl-1">);</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    .</span><span class="hl-6">catch</span><span class="hl-1">((</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-14">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Por último, tenemos que destacar que también hemos creado un router por defecto, este sí difiere del esquema que acabamos de explicar con el cliente. En este solo incluiremos el código siguiente:</p>
<pre><code><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-5">defaultRouter</span><span class="hl-1"> = </span><span class="hl-4">express</span><span class="hl-1">.</span><span class="hl-6">Router</span><span class="hl-1">();</span><br/><br/><span class="hl-4">defaultRouter</span><span class="hl-1">.</span><span class="hl-6">all</span><span class="hl-1">(</span><span class="hl-13">&quot;*&quot;</span><span class="hl-1">, (</span><span class="hl-4">_</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-14">501</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">();</span><br/><span class="hl-1">})</span>
</code><button>Copy</button></pre>
<p>Terminada esta carpeta, en la que se incluye la implementación también de los otros 3 routers, comentaremos la siguiente.</p>
<a id="md:db" class="tsd-anchor"></a><h2><a href="#md:db">DB</a></h2><p>Esta es la última carpeta que tenemos en src. Solo contiene un archivo, el de mongoose. Lo único que se hace en este archivo es establecer la conexión con MongoDB. Tiene la siguiente estructura:</p>
<pre><code><span class="hl-6">connect</span><span class="hl-1">(</span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-5">MONGODB_URL</span><span class="hl-1">!)</span><br/><span class="hl-1">  .</span><span class="hl-6">then</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-13">&quot;Connection to MongoDB server established&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  })</span><br/><span class="hl-1">  .</span><span class="hl-6">catch</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-13">&quot;Unable to connect to MongoDB server&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span>
</code><button>Copy</button></pre>
<a id="md:archivos-indexts-y-appts" class="tsd-anchor"></a><h2><a href="#md:archivos-indexts-y-appts">Archivos index.ts y app.ts</a></h2><p>Por último, comentar los archivos que están alojados directamente en src, sin ninguna subcarpeta. Estos son index y app. El primero lo que hace es escuchar en un puerto y mostrar por pantalla que se está escuchando en ese puerto.</p>
<pre><code><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-5">port</span><span class="hl-1"> = </span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-5">PORT</span><span class="hl-1">;</span><br/><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-6">listen</span><span class="hl-1">(</span><span class="hl-4">port</span><span class="hl-1">, () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-13">&quot;Server listening on&quot;</span><span class="hl-1">, </span><span class="hl-4">port</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>El segundo lo único que hace es instanciar todos los routers.</p>
<pre><code><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-6">use</span><span class="hl-1">(</span><span class="hl-4">customerRouter</span><span class="hl-1">);</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-6">use</span><span class="hl-1">(</span><span class="hl-4">providerRouter</span><span class="hl-1">);</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-6">use</span><span class="hl-1">(</span><span class="hl-4">furnitureRouter</span><span class="hl-1">);</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-6">use</span><span class="hl-1">(</span><span class="hl-4">transactionRouter</span><span class="hl-1">);</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-6">use</span><span class="hl-1">(</span><span class="hl-4">defaultRouter</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<a id="md:despliegue" class="tsd-anchor"></a><h2><a href="#md:despliegue">Despliegue</a></h2><p>Para desplegar la API se ha utilizado la herramienta Render, pero, previamente ha hecho falta desplegar también la base de datos, es por ello que además de Render se ha usado MongoDB Atlas para este último propósito. Con la base de datos en funcionamiento se procedió al despliegue de la API, que resultó en el siguiente enlace al que se pueden hacer peticiones:</p>
<ul>
<li><a href="https://ull-esit-inf-dsi-23-24-prct13-dsikea-api-kwlc.onrender.com">https://ull-esit-inf-dsi-23-24-prct13-dsikea-api-kwlc.onrender.com</a></li>
</ul>
<a id="md:conclusiones" class="tsd-anchor"></a><h2><a href="#md:conclusiones">Conclusiones</a></h2><p>Para finalizar, debemos destacar que esta es la última práctica de toda la asignatura, en la que hemos aplicado aspectos de Typescript que llevamos aprendiendo durante todo el curso. En esta concretamente, se nos pidió desarrollar un API REST, una aplicación más cercana a lo que podemos llegar a realizar en nuestros puestos de trabajo el día de mañana. </p>
<p>Comentar también que hemos creado pruebas usando supertest, como se nos especificaba en el guión. Además, la documentación la hemos hecho con Typedoc, el cubrimiento de código con Coveralls y el uso de Sonarcloud. También hemos desplegado la API con Render.</p>
<p>Con esto damos por finalizado la asignatura, en la cual hemos aprendido un nuevo lenguaje de programación, que nos será de gran utilidad para el resto de nuestra vida como ingenieros, además de herramientas como las mencionadas en el párrafo anterior.  </p>
<a id="md:bibliografía" class="tsd-anchor"></a><h2><a href="#md:bibliografía">Bibliografía</a></h2><ul>
<li><a href="https://expressjs.com/es">https://expressjs.com/es</a></li>
<li><a href="https://www.mongodb.com">https://www.mongodb.com</a></li>
<li><a href="https://mongoosejs.com">https://mongoosejs.com</a></li>
<li><a href="https://docs.render.com/deploy-mongodb">https://docs.render.com/deploy-mongodb</a></li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><ul><li><a href="#md:práctica-13---dsikea-api-rest-con-nodeexpress"><span>Práctica 13 -<wbr/> DSIkea: API REST con <wbr/>Node/<wbr/>Express</span></a></li></ul><a href="#md:datos-identificativos---grupo-k"><span>Datos identificativos -<wbr/> <wbr/>Grupo K</span></a><a href="#md:objetivos"><span>Objetivos</span></a><a href="#md:models"><span>Models</span></a><a href="#md:routers"><span>Routers</span></a><a href="#md:db"><span>DB</span></a><a href="#md:archivos-indexts-y-appts"><span>Archivos index.ts y app.ts</span></a><a href="#md:despliegue"><span>Despliegue</span></a><a href="#md:conclusiones"><span>Conclusiones</span></a><a href="#md:bibliografía"><span>Bibliografía</span></a></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="index.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>doc-test</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>